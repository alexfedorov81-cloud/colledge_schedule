{% extends 'base.html' %}
{% load static %}

{% block title %}–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è {{ teacher.get_full_name }}{% endblock %}

{% block content %}
<div class="row fade-in">
    <div class="col-12">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º -->
        <div class="card schedule-card mb-4">
            <div class="card-header schedule-header bg-primary text-white">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h5 class="mb-0">
                            üìÖ 
                            {% if current_week %}
                                –ù–µ–¥–µ–ª—è {{ current_week.week_number }} 
                                {% if current_week_by_date and current_week == current_week_by_date %}
                                    <span class="badge bg-success">–¢–µ–∫—É—â–∞—è –ø–æ –¥–∞—Ç–µ</span>
                                {% endif %}
                            {% else %}
                                –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è
                            {% endif %}
                            {% if week_start and week_end %}
                                ({{ week_start|date:"d.m.Y" }} - {{ week_end|date:"d.m.Y" }})
                            {% endif %}
                        </h5>
                        {% if current_week_by_date and current_week != current_week_by_date %}
                        <small class="text-warning">
                            ‚ö†Ô∏è –°–µ–π—á–∞—Å –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–µ–¥–µ–ª—è {{ current_week_by_date.week_number }} 
                            ({{ current_week_by_date.start_date|date:"d.m.Y" }} - {{ current_week_by_date.end_date|date:"d.m.Y" }})
                        </small>
                        {% endif %}
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="btn-group">
                            {% if has_previous %}
                            <a href="{% url 'schedule:teacher_schedule_week' teacher.id week_offset|add:'-1' %}" 
                               class="btn btn-sm btn-outline-light">
                                ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è
                            </a>
                            {% else %}
                            <button class="btn btn-sm btn-outline-light" disabled>
                                ‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è
                            </button>
                            {% endif %}
                            
                            <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–µ –ø–æ –¥–∞—Ç–µ -->
                            {% if current_week_by_date %}
                            <a href="{% url 'schedule:teacher_schedule' teacher.id %}" 
                               class="btn btn-sm btn-outline-warning">
                                üéØ –ö —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ
                            </a>
                            {% else %}
                            <a href="{% url 'schedule:teacher_schedule' teacher.id %}" 
                               class="btn btn-sm btn-outline-light">
                                –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è
                            </a>
                            {% endif %}
                            
                            {% if has_next %}
                            <a href="{% url 'schedule:teacher_schedule_week' teacher.id week_offset|add:'1' %}" 
                               class="btn btn-sm btn-outline-light">
                                –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è ‚Üí
                            </a>
                            {% else %}
                            <button class="btn btn-sm btn-outline-light" disabled>
                                –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è ‚Üí
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: {{ teacher.get_full_name|default:teacher.username }}</h1>
            <a href="{% url 'main_page' %}" class="btn btn-outline-primary btn-custom">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        </div>
        
        {% if teacher.teacherprofile.department %}
        <p class="lead">–ö–∞—Ñ–µ–¥—Ä–∞: {{ teacher.teacherprofile.department.name }}</p>
        {% endif %}
        
        {% if teacher.teacherprofile.academic_degree %}
        <p>–£—á–µ–Ω–∞—è —Å—Ç–µ–ø–µ–Ω—å: {{ teacher.teacherprofile.academic_degree }}</p>
        {% endif %}
        
        {% if total_weeks %}
        <p>–ü–æ–∫–∞–∑–∞–Ω–∞ –Ω–µ–¥–µ–ª—è {{ week_offset|add:"1" }} –∏–∑ {{ total_weeks }}</p>
        {% endif %}

        <!-- –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –≤—Å–µ–º –Ω–µ–¥–µ–ª—è–º-->
        {% if available_weeks %}
        <div class="card schedule-card mb-4">
            <div class="card-header schedule-header text-white">
                <h6 class="mb-0 fs-5">üìã –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –Ω–µ–¥–µ–ª—è–º</h6>
            </div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2">
                    {% for week in available_weeks %}

                        <a href="{% url 'schedule:teacher_schedule_week' teacher.id forloop.counter0 %}"
                           class="btn btn-sm {% if week == current_week %}btn-primary{% elif week == current_week_by_date %}btn-warning{% else %}btn-outline-primary{% endif %} week-nav-btn">
                        –ù–µ–¥–µ–ª—è {{ week.week_number }}
                        {% if week == current_week_by_date %}
                        <span class="badge bg-light text-dark ms-1">‚óè</span>
                        {% endif %}
                        </a>

                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ–¥–µ–ª—å
        <div class="card schedule-card mb-4">
            <div class="card-header schedule-header bg-success text-white">
                <h6 class="mb-0">üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–µ–º–µ—Å—Ç—Ä–∞</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-sm">
                        <thead class="table-light">
                            <tr>
                                <th>–ù–µ–¥–µ–ª—è</th>
                                <th>–î–∞—Ç—ã</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for week in available_weeks %}
                            <tr class="{% if week == current_week %}table-primary{% elif week == current_week_by_date %}table-warning{% endif %}">
                                <td class="fw-bold">–ù–µ–¥–µ–ª—è {{ week.week_number }}</td>
                                <td>{{ week.start_date|date:"d.m.Y" }} - {{ week.end_date|date:"d.m.Y" }}</td>
                                <td>
                                    {% if week == current_week_by_date %}
                                        <span class="badge bg-warning">–¢–µ–∫—É—â–∞—è –ø–æ –¥–∞—Ç–µ</span>
                                    {% endif %}
                                    {% if week.is_current %}
                                        <span class="badge bg-success">–û—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ —Ç–µ–∫—É—â–∞—è</span>
                                    {% endif %}
                                    {% if week.is_published %}
                                        <span class="badge bg-info">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                                    {% else %}
                                        <span class="badge bg-secondary">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'schedule:teacher_schedule_week' teacher.id forloop.counter0 %}"
                                       class="btn btn-sm
                                       {% if week == current_week %}btn-primary
                                       {% elif week == current_week_by_date %}btn-warning
                                       {% else %}btn-outline-primary{% endif %}">
                                        –ü–æ–∫–∞–∑–∞—Ç—å
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>-->
        {% endif %}

        {% if days %}
            {% for day_num, lessons in days.items %}
            <div class="card shedule-card mb-4">
                <div class="card-header schedule-header bg-secondary text-white">
                    <h5 class="mb-0">{{ lessons.0.get_day_of_week_display }}</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0 schedule-table">
                            <thead class="table-light">
                                <tr>
                                    <th class="px-3">–ü–∞—Ä–∞</th>
                                    <th class="px-3">–í—Ä–µ–º—è</th>
                                    <th class="px-3">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</th>
                                    <th class="px-3">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                    <th class="px-3">–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                                    <th class="px-3">–¢–∏–ø</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for lesson in lessons %}
                                <tr class="align-middle">
                                    <td class="px-3 fw-bold fs-5">{{ lesson.time_slot.order }}</td>
                                    <td class="px-3" nowrap>{{ lesson.time_slot.start_time|time:"H:i" }}-{{ lesson.time_slot.end_time|time:"H:i" }}</td>
                                    <td class="px-3">
                                        <strong>{{ lesson.subject.name }}</strong>
                                        {% if lesson.subject.code %}
                                        <br><small class="text-muted">–ö–æ–¥: {{ lesson.subject.code }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <strong>{{ lesson.group.name }}</strong>
                                        <br>
                                        <small class="text-muted">
                                            {{ lesson.group.specialization.name }}
                                            <br>–ö—É—Ä—Å: {{ lesson.group.course }}
                                        </small>
                                    </td>
                                    <td>
                                        {{ lesson.classroom.building.name }}, –∞—É–¥. {{ lesson.classroom.name }}
                                        <br>
                                        <small class="text-muted">
                                            {{ lesson.classroom.get_room_type_display }}
                                            {% if lesson.classroom.capacity %}
                                            (–¥–æ {{ lesson.classroom.capacity }} —á–µ–ª.)
                                            {% endif %}
                                        </small>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if lesson.lesson_type == 'lecture' %}bg-primary
                                            {% elif lesson.lesson_type == 'practice' %}bg-success
                                            {% elif lesson.lesson_type == 'lab' %}bg-warning
                                            {% else %}bg-secondary{% endif %}">
                                            {{ lesson.get_lesson_type_display }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row text-center mt-4 g-3">
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ days|length }}</div>
                        <small>–£—á–µ–±–Ω—ã—Ö –¥–Ω–µ–π</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ total_lessons }}</div>
                        <small>–í—Å–µ–≥–æ –ø–∞—Ä</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ unique_groups }}</div>
                        <small>–ì—Ä—É–ø–ø</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ unique_subjects }}</div>
                        <small>–î–∏—Å—Ü–∏–ø–ª–∏–Ω</small>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="alert alert-info">
                <h4>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h4>
                <p>–î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–Ω—è—Ç–∏–π.</p>
                <div class="mt-3">
                    <a href="/admin/schedule/schedule/add/" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ</a>
                    <a href="{% url 'main_page' %}" class="btn btn-outline-secondary">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    
                    {% if available_weeks %}
                    <div class="mt-3">
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –Ω–µ–¥–µ–ª–∏:</p>
                        <div class="btn-group">
                            {% for week in available_weeks|slice:":5" %}
                            <a href="{% url 'schedule:teacher_schedule_week' teacher.id forloop.counter0 %}" 
                               class="btn btn-sm btn-outline-primary">
                                –ù–µ–¥–µ–ª—è {{ week.week_number }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}