{% extends 'base.html' %}
{% load static %}

{% block title %}–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã {{ group.name }}{% endblock %}

{% block content %}
<div class="row fade-in">
    <div class="col-12">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="card schedule-card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h2 mb-2 fw-bold text-primary">–ì—Ä—É–ø–ø–∞: {{ group.name }}</h1>
                        <p class="text-muted mb-1 fs-5">
                            <strong>{{ group.specialization.name }}</strong> | –ö—É—Ä—Å: {{ group.course }}
                        </p>
                        {% if current_week %}
                        <p class="text-muted mb-0">
                            –ù–µ–¥–µ–ª—è {{ current_week.week_number }} ({{ week_start|date:"d.m.Y" }} - {{ week_end|date:"d.m.Y" }})
                        </p>
                        {% endif %}
                    </div>
                    <a href="{% url 'main_page' %}" class="btn btn-outline-primary btn-custom">‚Üê –ù–∞–∑–∞–¥</a>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º-->
        <div class="card schedule-card mb-4">
            <div class="card-body py-3">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="btn-group week-nav-btn">
                            {% if has_previous %}
                            <a href="{% url 'schedule:group_schedule_week' group.id week_offset|add:'-1' %}"
                               class="btn btn-outline-primary week-nav-btn">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                            {% else %}
                            <button class="btn btn-outline-secondary" disabled>‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                            {% endif %}

                            {% if current_week_by_date %}
                            <a href="{% url 'schedule:group_schedule' group.id %}"
                               class="btn btn-warning week-nav-btn">üéØ –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</a>
                            {% else %}
                            <a href="{% url 'schedule:group_schedule' group.id %}"
                               class="btn btn-outline-primary week-nav-btn">–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</a>
                            {% endif %}

                            {% if has_next %}
                            <a href="{% url 'schedule:group_schedule_week' group.id week_offset|add:'1' %}"
                               class="btn btn-outline-primary week-nav-btn">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
                            {% else %}
                            <button class="btn btn-outline-secondary" disabled>–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="text-muted">
                            <small>–ù–µ–¥–µ–ª—è {{ week_offset|add:"1" }} –∏–∑ {{ total_weeks }}</small>
                            {% if current_week_by_date and current_week != current_week_by_date %}
                            <br><small class="text-warning fw-bold">‚ö†Ô∏è –ê–∫—Ç—É–∞–ª—å–Ω–æ: –Ω–µ–¥–µ–ª—è {{ current_week_by_date.week_number }}</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--–ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –Ω–µ–¥–µ–ª—è–º-->
        {% if available_weeks %}
        <div class="card schedule-card mb-4">
            <div class="card-header schedule-header text-white">
                <h6 class="mb-0 fs-5">üìã –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –Ω–µ–¥–µ–ª—è–º</h6>
            </div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2">
                    {% for week in available_weeks %}
                    <a href="{% url 'schedule:group_schedule_week' group.id forloop.counter0 %}"
                       class="btn btn-sm {% if week == current_week %}btn-primary{% elif week == current_week_by_date %}btn-warning{% else %}btn-outline-primary{% endif %} week-nav-btn">
                        –ù–µ–¥–µ–ª—è {{ week.week_number }}
                        {% if week == current_week_by_date %}
                        <span class="badge bg-light text-dark ms-1">‚óè</span>
                        {% endif %}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}


        <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
        {% if days %}
            {% for day_num, lessons in days.items %}
            <div class="card schedule-card mb-4">
                <div class="card-header schedule-header text-white">
                    <h5 class="mb-0 fs-5">{{ lessons.0.get_day_of_week_display }}</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0 schedule-table">
                            <thead class="table-dark">
                                <tr>
                                    <th class="px-3">–ü–∞—Ä–∞</th>
                                    <th class="px-3">–í—Ä–µ–º—è</th>
                                    <th class="px-3">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</th>
                                    <th class="px-3">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                    <th class="px-3">–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                                    <th class="px-3">–¢–∏–ø</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for lesson in lessons %}
                                <tr class="align-middle">
                                    <td class="px-3 fw-bold fs-5">{{ lesson.time_slot.order }}</td>
                                    <td class="px-3" nowrap>
                                        <strong>{{ lesson.time_slot.start_time|time:"H:i" }}-{{ lesson.time_slot.end_time|time:"H:i" }}</strong>
                                    </td>
                                    <td class="px-3">
                                        <div>
                                            <strong class="fs-6">{{ lesson.subject.name }}</strong>
                                            {% if lesson.subject.code %}
                                            <br><small class="text-muted">{{ lesson.subject.code }}</small>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <div>
                                            <strong>{{ lesson.teacher.get_full_name|default:lesson.teacher.username }}</strong>
                                            {% if lesson.teacher.teacherprofile.academic_degree %}
                                            <br><small class="text-muted">{{ lesson.teacher.teacherprofile.academic_degree }}</small>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <div>
                                            <strong>{{ lesson.classroom.building.name }}, –∞—É–¥. {{ lesson.classroom.name }}</strong>
                                            <br>
                                            <small class="text-muted">
                                                {{ lesson.classroom.get_room_type_display }}
                                                {% if lesson.classroom.capacity %}
                                                (–¥–æ {{ lesson.classroom.capacity }} —á–µ–ª.)
                                                {% endif %}
                                            </small>
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <span class="badge {% if lesson.lesson_type == 'lecture' %}badge-lecture{% elif lesson.lesson_type == 'practice' %}badge-practice{% elif lesson.lesson_type == 'lab' %}badge-lab{% else %}bg-secondary{% endif %} p-2 fs-6">
                                            {{ lesson.get_lesson_type_display }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endfor %}

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            <div class="row text-center mt-4 g-3">
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ days|length }}</div>
                        <small>–£—á–µ–±–Ω—ã—Ö –¥–Ω–µ–π</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ total_lessons }}</div>
                        <small>–í—Å–µ–≥–æ –ø–∞—Ä</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ unique_teachers }}</div>
                        <small>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</small>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card rounded-3 p-3">
                        <div class="stats-number">{{ unique_subjects }}</div>
                        <small>–î–∏—Å—Ü–∏–ø–ª–∏–Ω</small>
                    </div>
                </div>
            </div>-->
        {% else %}
            <div class="card schedule-card">
                <div class="card-body text-center py-5">
                    <div class="mb-4">
                        <span class="display-1">üìÖ</span>
                    </div>
                    <h4 class="text-muted mb-3">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h4>
                    <p class="text-muted mb-4">–î–ª—è —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–Ω—è—Ç–∏–π.</p>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="/admin/schedule/schedule/add/" class="btn btn-primary btn-custom">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ</a>
                        <a href="{% url 'main_page' %}" class="btn btn-outline-secondary btn-custom">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>



{% endblock %}